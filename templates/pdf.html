<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ title or 'AddEvent Categories (PDF)' }}</title>
  <style>
    @page {
      size: Letter;
      margin: 18mm 16mm 20mm;
      @bottom-center { content: "Page " counter(page) " of " counter(pages); font-size:10pt; color:#6b7280; }
    }
    body { font: 11pt/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial; color:#111827; }
    h1 { font-size: 20pt; margin: 0 0 8mm; }
    h2 { font-size: 14pt; margin: 10mm 0 6px; padding-bottom: 4px; border-bottom: 1.5px solid #e5e7eb; }

    table { width: 100%; border-collapse: separate; border-spacing: 0 6px; }
    thead th { text-align: left; font-size: 10pt; color:#6b7280; font-weight:700; padding:4px 6px; border-bottom:1px solid #e5e7eb; }
    td { vertical-align: top; padding: 6px 8px; background:#f9fafb; border-radius: 8px; }
    .col-date  { width: 22%; white-space: nowrap; font-weight: 700; }
    .col-title { width: 38%; }
    .col-links { width: 40%; }
    a { color:#1d4ed8; text-decoration: none; }
    .url { color:#6b7280; font-size: 9.5pt; word-break: break-all; }
    .row { break-inside: avoid; }
    p, .col-title { orphans: 3; widows: 3; }
  </style>
</head>
<body>
  <h1>{{ title or 'AddEvent Categories' }}</h1>

  {% for label, items in categories.items() %}
    {% if items and items|length %}
      <h2>{{ label }}</h2>

      <table role="table" aria-label="{{ label }}">
        <thead>
          <tr>
            <th class="col-date">Date</th>
            <th class="col-title">Title</th>
            <th class="col-links">Links</th>
          </tr>
        </thead>
        <tbody>
          {% for ev in items %}
            <tr class="row">
              <td class="col-date">
                {% set dt = ev.starts_at_dt %}
                {% if dt %}
                  {{ dt.strftime("%Y-%m-%d %H:%M") }}
                {% elif ev.when_text %}
                  {{ ev.when_text }}
                {% else %}
                  â€”
                {% endif %}
              </td>
              <td class="col-title">
                {{ ev.title }}
              </td>
              <td class="col-links">
                {% if ev.original_link %}
                  <div><strong>Link:</strong> <a href="{{ ev.original_link }}">{{ ev.original_link }}</a></div>
                  <div class="url">{{ ev.original_link }}</div>
                {% elif ev.addevent_url %}
                  <div><strong>Calendar:</strong> <a href="{{ ev.addevent_url }}">{{ ev.addevent_url }}</a></div>
                  <div class="url">{{ ev.addevent_url }}</div>
                {% else %}
                  <div class="url"><em>No link found in description.</em></div>
                {% endif %}

                {% if include_ics %}
                  <div style="margin-top:4px;">
                    <strong>ICS:</strong>
                    <a href="{{ url_for('add_event_pull.add_event_pull_event_ics', event_id=(ev.id if ev.id is defined else ev['id']), _external=True) }}">
                      Download .ics
                    </a>
                  </div>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  {% endfor %}

  <div class="muted" style="margin-top:10mm;">
    Generated {{ generated_at.strftime("%Y-%m-%d %H:%M") }}
  </div>
</body>
</html>
